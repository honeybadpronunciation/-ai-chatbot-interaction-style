import openai
from transformers import pipeline
import random

# è®¾ç½® OpenAI API å¯†é’¥
openai.api_key = "your-api-key-here"  # 

# åŠ è½½æƒ…æ„Ÿåˆ†æç®¡é“
classifier = pipeline('sentiment-analysis')

# æƒ…æ„Ÿåˆ†æåçš„å›å¤é£æ ¼
def adjust_response_for_emotion(emotion, raw_response):
    """æ ¹æ®æƒ…æ„ŸçŠ¶æ€è°ƒæ•´ AI å›å¤é£æ ¼"""
    if emotion == 'positive':
        return f"ğŸ‰ å¤ªæ£’äº†ï¼{raw_response}ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·ç»§ç»­åŠªåŠ›ï¼"
    elif emotion == 'negative':
        return f"ğŸ˜ æˆ‘æ˜ç™½ä½ çš„æ„Ÿå—ï¼Œ{raw_response}ã€‚è®©æˆ‘ä»¬ä¸€èµ·å¯»æ‰¾è§£å†³æ–¹æ¡ˆå§ã€‚"
    elif emotion == 'neutral':
        return f"{raw_response}ã€‚è®©æˆ‘ä»¬ç»§ç»­è®¨è®ºï¼Œçœ‹çœ‹æ¥ä¸‹æ¥èƒ½åšä»€ä¹ˆã€‚"
    else:
        return raw_response

# ç”¨ GPT ç”Ÿæˆä¸€ä¸ªå›å¤
def generate_ai_response(prompt):
    """ç”Ÿæˆ AI å›å¤"""
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[
            {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªå¯Œæœ‰åŒç†å¿ƒã€è‰ºæœ¯æ„Ÿçš„AIåŠ©æ‰‹ï¼Œä¸“æ³¨äºç†è§£å¹¶å›åº”ç”¨æˆ·çš„æƒ…æ„Ÿéœ€æ±‚ã€‚"},
            {"role": "user", "content": prompt}
        ],
        temperature=0.8,
        max_tokens=150
    )
    return response['choices'][0]['message']['content']

# è·å–ç”¨æˆ·è¾“å…¥å¹¶åˆ†ææƒ…æ„Ÿ
def interact_with_user(user_input):
    """æ ¹æ®ç”¨æˆ·è¾“å…¥ä¸ AI è¿›è¡Œäº¤äº’ï¼Œå¹¶æ ¹æ®æƒ…æ„Ÿè°ƒæ•´ AI å›å¤"""
    
    # è¿›è¡Œæƒ…æ„Ÿåˆ†æ
    sentiment = classifier(user_input)[0]
    emotion = sentiment['label'].lower()  # è·å–æƒ…æ„Ÿæ ‡ç­¾ï¼ˆpositive/negative/neutralï¼‰
    
    # ä½¿ç”¨ GPT ç”Ÿæˆ AI å›å¤
    ai_response = generate_ai_response(user_input)
    
    # æ ¹æ®æƒ…æ„ŸçŠ¶æ€è°ƒæ•´ AI å›å¤çš„è¯­æ°”å’Œé£æ ¼
    adjusted_response = adjust_response_for_emotion(emotion, ai_response)
    
    return adjusted_response

# æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’
if __name__ == "__main__":
    user_input = input("è¯·è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–æ„Ÿå—ï¼š\n> ")
    ai_output = interact_with_user(user_input)
    print("\nAI å›å¤ï¼š", ai_output)
