import openai
import random

# ä½ çš„ OpenAI API Key
openai.api_key = "your-api-key-here"  # <-- æ›¿æ¢æˆä½ è‡ªå·±çš„ key

# === é£æ ¼è°ƒä¼˜æ¨¡å— ===

RHETORIC_DEVICES = [
    lambda text: f"ä»¿ä½›æ¢¦å¢ƒä¸€èˆ¬ï¼Œ{text}",
    lambda text: f"{text}ï¼Œæ­£å¦‚æ˜¥æ°´åˆèï¼Œæ¸©æŸ”åˆåšéŸ§ã€‚",
    lambda text: f"{text}ï¼Ÿä¸ï¼Œè¿™æ˜¯ä¸€åœºçµé­‚çš„ä½è¯­ã€‚"
]

NARRATIVE_PATTERNS = [
    lambda text: f"èµ·åˆï¼Œ{text}ã€‚ç„¶åï¼Œä¸€åˆ‡é€æ¸å±•å¼€ã€‚",
    lambda text: f"{text}â€”â€”é‚£æ˜¯æ•…äº‹çš„ç¬¬ä¸€ç« ã€‚",
    lambda text: f"å°±åƒå‘½è¿æ‚„ç„¶é“ºé™ˆï¼Œ{text}"
]

EMOTIONAL_MODULATION = {
    "warm": lambda text: f"{text} æ„Ÿè§‰åƒé˜³å…‰æ´’åœ¨è‚©å¤´ï¼Œæš–æš–çš„ã€‚",
    "sad": lambda text: f"{text}ï¼Œä½†å¿ƒä¸­å´æ³›èµ·äº†éšéšçš„å¿§ä¼¤ã€‚",
    "neutral": lambda text: f"{text}ï¼Œå¦‚æ­¤å¹³é™ï¼Œå¦‚æ°´é¢æ— æ³¢ã€‚"
}

def refine_text(input_text, emotion="warm", use_rhetoric=True, use_narrative=True):
    output = input_text.strip()
    if use_narrative:
        output = random.choice(NARRATIVE_PATTERNS)(output)
    if use_rhetoric:
        output = random.choice(RHETORIC_DEVICES)(output)
    if emotion in EMOTIONAL_MODULATION:
        output = EMOTIONAL_MODULATION[emotion](output)
    return output

# === GPT åŸå§‹è¾“å‡ºå‡½æ•° ===

def generate_text(prompt, model="gpt-3.5-turbo"):
    response = openai.ChatCompletion.create(
        model=model,
        messages=[
            {"role": "system", "content": "ä½ æ˜¯ä¸€ä½æ¸©æŸ”è€Œå¯Œæœ‰è¯—æ„çš„å™è¿°è€…ã€‚"},
            {"role": "user", "content": prompt}
        ],
        temperature=0.7
    )
    return response['choices'][0]['message']['content']

# === ä¸»æµç¨‹ ===

if __name__ == "__main__":
    user_prompt = input("è¯·è¾“å…¥ä½ æƒ³è®© AI æè¿°çš„å†…å®¹ï¼š\n> ")
    
    print("\nğŸ“¤ GPT æ­£åœ¨ç”ŸæˆåŸå§‹æ–‡æœ¬...")
    raw_output = generate_text(user_prompt)
    print("\nğŸ“ åŸå§‹è¾“å‡ºï¼š\n", raw_output)

    refined = refine_text(raw_output, emotion="warm")
    print("\nğŸ¨ é£æ ¼ä¼˜åŒ–åè¾“å‡ºï¼š\n", refined)
